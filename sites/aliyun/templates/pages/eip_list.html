{% extends "layouts/base.html" %}

{% block content %}
{% include 'components/navbar.html' %}

<main class="main-content" x-data="eipList()">
    <div class="container">
        <h1>EIP 列表</h1>

        <!-- 区域选择和搜索 -->
        <div class="filters">
            <div class="filter-group">
                <label>地域:</label>
                <select x-model="regionId" @change="changeRegion()" :disabled="regionsLoading">
                    <template x-if="regionsLoading">
                        <option>加载中...</option>
                    </template>
                    <template x-if="!regionsLoading">
                        <template x-for="region in regions" :key="region.id">
                            <option :value="region.id" x-text="region.name" :selected="regionId === region.id"></option>
                        </template>
                    </template>
                </select>
            </div>
            <div class="filter-group">
                <input type="text" x-model="filters.eipName" placeholder="EIP名称" @keyup.enter="search()">
            </div>
            <div class="filter-group">
                <input type="text" x-model="filters.eipAddress" placeholder="EIP地址" @keyup.enter="search()">
            </div>
            <div class="filter-group">
                <input type="text" x-model="filters.allocationId" placeholder="实例ID" @keyup.enter="search()">
            </div>
            <div class="filter-group">
                <input type="text" x-model="filters.associatedInstanceId" placeholder="绑定实例ID" @keyup.enter="search()">
            </div>
            <button @click="search()" class="btn btn-primary">搜索</button>
        </div>

        <!-- 错误提示 -->
        <div x-show="error" x-text="error" class="alert alert-error" x-cloak></div>

        <!-- 加载中 -->
        <div x-show="loading" class="loading" x-cloak>加载中...</div>

        <!-- EIP表格 -->
        <div x-show="!loading && !error" class="table-container" x-cloak>
            <table class="table">
                <thead>
                    <tr>
                        <th>EIP名称</th>
                        <th>EIP地址</th>
                        <th>实例ID</th>
                        <th>绑定实例</th>
                        <th>带宽</th>
                        <th>状态</th>
                    </tr>
                </thead>
                <tbody>
                    <template x-if="eips.length === 0">
                        <tr>
                            <td colspan="6" style="text-align: center; padding: 40px;">暂无数据</td>
                        </tr>
                    </template>
                    <template x-for="eip in eips" :key="eip.AllocationId">
                        <tr>
                            <td x-text="eip.Name || '-'"></td>
                            <td x-text="eip.IpAddress"></td>
                            <td x-text="eip.AllocationId"></td>
                            <td x-text="eip.InstanceId || '-'"></td>
                            <td x-text="`${eip.Bandwidth}Mbps`"></td>
                            <td>
                                <span class="status-badge" :class="`status-${formatStatus(eip.Status).class}`" x-text="formatStatus(eip.Status).text"></span>
                            </td>
                        </tr>
                    </template>
                </tbody>
            </table>
        </div>

        <!-- 分页 -->
        <div x-show="!loading && totalPages > 1" class="pagination" x-cloak>
            <button @click="loadEips(currentPage - 1)" :disabled="currentPage === 1">上一页</button>
            <span class="page-number" x-text="`第 ${currentPage} / ${totalPages} 页`"></span>
            <button @click="loadEips(currentPage + 1)" :disabled="currentPage === totalPages">下一页</button>
            <span class="pagination-info" x-text="`共 ${totalCount} 条`"></span>
            <div class="page-size-selector">
                <label>每页显示:</label>
                <select x-model="pageSize" @change="changePageSize()">
                    <option value="20">20条</option>
                    <option value="50">50条</option>
                    <option value="100">100条</option>
                </select>
            </div>
        </div>
    </div>
</main>
{% endblock %}

{% block extra_js %}
<script>
window.APP_CONFIG = {{ config|json|safe }};
</script>
<script src="{{ base_path }}/static/js/aliyun-api.js"></script>
<script src="{{ base_path }}/static/js/auth.js"></script>
{% endblock %}
