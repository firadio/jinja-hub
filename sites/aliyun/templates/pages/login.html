{% extends "layouts/base.html" %}

{% block content %}
<div x-data="loginPage()">
    <div class="min-h-screen bg-base-200 flex items-center justify-center p-4">
        <div class="card w-full max-w-lg bg-base-100 shadow-2xl">
            <div class="card-body">
                <!-- 标题 -->
                <h1 class="text-3xl font-bold text-center mb-2">{{ config.site.title }}</h1>
                <p class="text-center text-base-content/60 mb-6">{{ config.site.description }}</p>

                <!-- 错误提示 -->
                <div x-show="error" x-cloak class="alert alert-error shadow-lg mb-4">
                    <svg xmlns="http://www.w3.org/2000/svg" class="stroke-current shrink-0 h-6 w-6" fill="none" viewBox="0 0 24 24">
                        <path stroke-linecap="round" stroke-linejoin="round" stroke-width="2" d="M10 14l2-2m0 0l2-2m-2 2l-2-2m2 2l2 2m7-2a9 9 0 11-18 0 9 9 0 0118 0z" />
                    </svg>
                    <span x-text="error"></span>
                </div>

                <!-- 密钥选择界面 -->
                <div x-show="hasKeys" x-cloak>
                    <h3 class="text-xl font-semibold mb-4">选择密钥</h3>
                    <div class="space-y-3 mb-6">
                        <template x-for="(key, index) in keys" :key="index">
                            <div class="card bg-base-200">
                                <div class="card-body p-4 flex-row items-center justify-between">
                                    <div class="flex-1">
                                        <div class="font-semibold mb-1" x-text="key.name || '未命名'"></div>
                                        <div class="text-sm text-base-content/60 font-mono" x-text="key.accessKeyId"></div>
                                    </div>
                                    <div class="flex gap-2">
                                        <button @click="selectKey(index)" class="btn btn-sm btn-primary">选择</button>
                                        <button @click="deleteKey(index)" class="btn btn-sm btn-error">删除</button>
                                    </div>
                                </div>
                            </div>
                        </template>
                    </div>
                    <button @click="showAddForm()" class="btn btn-outline btn-block text-aliyun-orange border-aliyun-orange hover:bg-aliyun-orange hover:text-white">
                        添加新密钥
                    </button>
                </div>

                <!-- 登录表单 -->
                <form x-show="!hasKeys" @submit.prevent="login()" x-cloak class="space-y-4">
                    <div class="form-control w-full">
                        <label class="label">
                            <span class="label-text">名称 (可选)</span>
                        </label>
                        <input type="text"
                               class="input input-bordered w-full"
                               x-model="form.name"
                               placeholder="例如: 生产环境">
                    </div>

                    <div class="form-control w-full">
                        <label class="label">
                            <span class="label-text">AccessKey ID</span>
                        </label>
                        <input type="text"
                               class="input input-bordered w-full"
                               x-model="form.accessKeyId"
                               required
                               placeholder="请输入 AccessKey ID">
                    </div>

                    <div class="form-control w-full">
                        <label class="label">
                            <span class="label-text">AccessKey Secret</span>
                        </label>
                        <input type="password"
                               class="input input-bordered w-full"
                               x-model="form.accessKeySecret"
                               required
                               placeholder="请输入 AccessKey Secret">
                    </div>

                    <button type="submit" class="btn btn-primary btn-block" :disabled="loading">
                        <span x-show="!loading">登录</span>
                        <span x-show="loading">
                            <span class="loading loading-spinner loading-sm"></span>
                            登录中...
                        </span>
                    </button>
                </form>
            </div>
        </div>
    </div>
</div>
{% endblock %}

{% block extra_js %}
<script>
window.APP_CONFIG = {{ config|json|safe }};
</script>
<script src="{{ base_path }}/static/js/auth.js"></script>
{% endblock %}
