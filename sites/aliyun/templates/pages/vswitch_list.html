{% extends "layouts/base.html" %}

{% block content %}
{% include 'components/navbar.html' %}

<main class="main-content" x-data="vswitchList()">
    <div class="container">
        <h1>交换机列表</h1>

        <!-- 区域选择 -->
        <div class="filters">
            <div class="filter-group">
                <label>地域:</label>
                <select x-model="regionId" @change="changeRegion()">
                    {% for region in config.regions %}
                    <option value="{{ region.id }}">{{ region.name }}</option>
                    {% endfor %}
                </select>
            </div>
        </div>

        <!-- 错误提示 -->
        <div x-show="error" x-text="error" class="alert alert-error" x-cloak></div>

        <!-- 加载中 -->
        <div x-show="loading" class="loading" x-cloak>加载中...</div>

        <!-- 交换机表格 -->
        <div x-show="!loading && !error" class="table-container" x-cloak>
            <table class="table">
                <thead>
                    <tr>
                        <th>交换机名称</th>
                        <th>交换机ID</th>
                        <th>CIDR块</th>
                        <th>可用IP数</th>
                        <th>状态</th>
                        <th>创建时间</th>
                    </tr>
                </thead>
                <tbody>
                    <template x-if="vswitches.length === 0">
                        <tr>
                            <td colspan="6" style="text-align: center; padding: 40px;">暂无数据</td>
                        </tr>
                    </template>
                    <template x-for="vswitch in vswitches" :key="vswitch.VSwitchId">
                        <tr>
                            <td x-text="vswitch.VSwitchName || '-'"></td>
                            <td x-text="vswitch.VSwitchId"></td>
                            <td x-text="vswitch.CidrBlock"></td>
                            <td x-text="vswitch.AvailableIpAddressCount"></td>
                            <td>
                                <span class="status-badge" :class="`status-${formatStatus(vswitch.Status).class}`" x-text="formatStatus(vswitch.Status).text"></span>
                            </td>
                            <td x-text="formatTime(vswitch.CreationTime)"></td>
                        </tr>
                    </template>
                </tbody>
            </table>
        </div>

        <!-- 分页 -->
        <div x-show="!loading && totalPages > 1" class="pagination" x-cloak>
            <button @click="loadVSwitches(currentPage - 1)" :disabled="currentPage === 1">上一页</button>
            <span class="page-number" x-text="`第 ${currentPage} / ${totalPages} 页`"></span>
            <button @click="loadVSwitches(currentPage + 1)" :disabled="currentPage === totalPages">下一页</button>
            <span class="pagination-info" x-text="`共 ${totalCount} 条`"></span>
            <div class="page-size-selector">
                <label>每页显示:</label>
                <select x-model="pageSize" @change="changePageSize()">
                    <option value="20">20条</option>
                    <option value="50">50条</option>
                    <option value="100">100条</option>
                </select>
            </div>
        </div>
    </div>
</main>
{% endblock %}

{% block extra_js %}
<script>
window.APP_CONFIG = {{ config|json|safe }};
</script>
<script src="{{ base_path }}/static/js/aliyun-api.js"></script>
<script src="{{ base_path }}/static/js/auth.js"></script>
<script src="{{ base_path }}/static/js/alpine-components.js"></script>
{% endblock %}
