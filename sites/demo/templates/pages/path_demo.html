{% extends "layouts/base.html" %}

{% block title %}è·¯å¾„è‡ªåŠ¨é€‚é…æ¼”ç¤º{% endblock %}

{% block content %}
<div class="demo-container">
    <h1>ğŸ”— è·¯å¾„è‡ªåŠ¨é€‚é…æ¼”ç¤º</h1>
    <p class="subtitle">æŸ¥çœ‹ä¸åŒè®¿é—®æ–¹å¼ä¸‹è·¯å¾„çš„è‡ªåŠ¨è°ƒæ•´</p>

    <div class="card">
        <h2>å½“å‰è®¿é—®ä¿¡æ¯</h2>
        <table>
            <tr>
                <td><strong>ç«™ç‚¹åç§°:</strong></td>
                <td>{{ site.name }}</td>
            </tr>
            <tr>
                <td><strong>ç«™ç‚¹ID:</strong></td>
                <td>{{ site_name }}</td>
            </tr>
            <tr>
                <td><strong>åŸºç¡€è·¯å¾„ (base_path):</strong></td>
                <td><code>{{ base_path }}</code></td>
            </tr>
        </table>
    </div>

    <div class="card">
        <h2>è·¯å¾„æ¨¡å¼è¯´æ˜</h2>
        <div style="background: #f0f9ff; padding: 15px; border-radius: 6px; border-left: 4px solid #0ea5e9;">
            <p style="margin: 0;"><strong>å½“å‰æ¨¡å¼:</strong></p>
            {% if base_path == '/' %}
            <p style="color: #0284c7; margin: 5px 0 0 0;">âœ“ åŸŸåè®¿é—®æ¨¡å¼ - base_path = "/"</p>
            <p style="color: #64748b; margin: 5px 0 0 0; font-size: 0.9rem;">
                é€šè¿‡åŸŸåç›´æ¥è®¿é—® (ä¾‹å¦‚: demo.example.com)
            </p>
            {% else %}
            <p style="color: #0284c7; margin: 5px 0 0 0;">âœ“ è·¯å¾„è®¿é—®æ¨¡å¼ - base_path = "{{ base_path }}"</p>
            <p style="color: #64748b; margin: 5px 0 0 0; font-size: 0.9rem;">
                é€šè¿‡è·¯å¾„è®¿é—® (ä¾‹å¦‚: example.com{{ base_path }}/)
            </p>
            {% endif %}
        </div>
    </div>

    <div class="card">
        <h2>è‡ªåŠ¨é€‚é…ç¤ºä¾‹</h2>

        <h3>1. é™æ€æ–‡ä»¶</h3>
        <div class="code-example">
            <p><strong>æ¨¡æ¿ä»£ç :</strong></p>
            <pre><code>&lt;link href="{{ '{{' }} base_path }}/static/css/style.css"&gt;</code></pre>
            <p><strong>æ¸²æŸ“ç»“æœ:</strong></p>
            <pre><code>&lt;link href="{{ base_path }}/static/css/style.css"&gt;</code></pre>
        </div>

        <h3>2. é¡µé¢é“¾æ¥</h3>
        <div class="code-example">
            <p><strong>æ¨¡æ¿ä»£ç :</strong></p>
            <pre><code>&lt;a href="{{ '{{' }} base_path }}/"&gt;é¦–é¡µ&lt;/a&gt;</code></pre>
            <p><strong>æ¸²æŸ“ç»“æœ:</strong></p>
            <pre><code>&lt;a href="{{ base_path }}/"&gt;é¦–é¡µ&lt;/a&gt;</code></pre>
            <p><strong>å®é™…é“¾æ¥:</strong></p>
            <a href="{{ base_path }}/" style="color: #0ea5e9;">ç‚¹å‡»è®¿é—®é¦–é¡µ</a>
        </div>

        <h3>3. API è°ƒç”¨</h3>
        <div class="code-example">
            <p><strong>æ¨¡æ¿ä»£ç :</strong></p>
            <pre><code>fetch('{{ '{{' }} base_path }}/api/config')</code></pre>
            <p><strong>æ¸²æŸ“ç»“æœ:</strong></p>
            <pre><code>fetch('{{ base_path }}/api/config')</code></pre>
            <button onclick="testAPI()" class="btn">æµ‹è¯• API è°ƒç”¨</button>
            <div id="apiResult" style="margin-top: 10px;"></div>
        </div>
    </div>

    <div class="card">
        <h2>æµ‹è¯•é“¾æ¥</h2>
        <ul style="list-style: none; padding: 0;">
            <li style="margin: 10px 0;">
                <a href="{{ base_path }}/" class="test-link">{{ base_path }}/ (é¦–é¡µ)</a>
            </li>
            <li style="margin: 10px 0;">
                <a href="{{ base_path }}/index.html" class="test-link">{{ base_path }}/index.html</a>
            </li>
            <li style="margin: 10px 0;">
                <a href="{{ base_path }}/path_demo.html" class="test-link">{{ base_path }}/path_demo.html (å½“å‰é¡µ)</a>
            </li>
        </ul>
    </div>

    <div class="card">
        <h2>å¦‚ä½•æµ‹è¯•åŸŸåæ¨¡å¼</h2>
        <ol>
            <li>åœ¨ <code>sites/sites.json</code> ä¸­é…ç½®åŸŸå:
                <pre><code>"demo": {
  "domains": ["demo.localhost"]
}</code></pre>
            </li>
            <li>è®¿é—® <code>http://demo.localhost:8080/</code></li>
            <li>è§‚å¯Ÿ base_path å˜åŒ–: <code>/demo</code> â†’ <code>/</code></li>
        </ol>
    </div>
</div>

<style>
.card h3 {
    margin-top: 20px;
    margin-bottom: 10px;
    color: #475569;
    font-size: 1.1rem;
}

.code-example {
    background: #f8fafc;
    padding: 15px;
    border-radius: 6px;
    margin: 15px 0;
}

.code-example p {
    margin: 8px 0;
    color: #64748b;
}

.code-example pre {
    background: #1e293b;
    color: #e2e8f0;
    padding: 12px;
    border-radius: 4px;
    overflow-x: auto;
    margin: 8px 0;
}

.code-example code {
    font-family: 'Courier New', monospace;
    font-size: 0.9rem;
}

.btn {
    background: #0ea5e9;
    color: white;
    border: none;
    padding: 8px 16px;
    border-radius: 6px;
    cursor: pointer;
    font-size: 0.9rem;
}

.btn:hover {
    background: #0284c7;
}

.test-link {
    display: inline-block;
    padding: 8px 16px;
    background: #ede9fe;
    color: #7c3aed;
    text-decoration: none;
    border-radius: 6px;
    transition: all 0.2s;
}

.test-link:hover {
    background: #ddd6fe;
    transform: translateX(4px);
}
</style>

<script>
function testAPI() {
    const resultDiv = document.getElementById('apiResult');
    resultDiv.innerHTML = '<p style="color: #64748b;">åŠ è½½ä¸­...</p>';

    fetch('{{ base_path }}/api/config')
        .then(res => res.json())
        .then(data => {
            resultDiv.innerHTML = `
                <div style="background: #d1fae5; color: #065f46; padding: 10px; border-radius: 4px; margin-top: 8px;">
                    <strong>âœ“ API è°ƒç”¨æˆåŠŸ!</strong>
                    <pre style="background: #f0fdf4; color: #166534; padding: 8px; border-radius: 4px; margin-top: 8px; overflow-x: auto;">${JSON.stringify(data, null, 2)}</pre>
                </div>
            `;
        })
        .catch(err => {
            resultDiv.innerHTML = `
                <div style="background: #fee2e2; color: #991b1b; padding: 10px; border-radius: 4px; margin-top: 8px;">
                    <strong>âœ— API è°ƒç”¨å¤±è´¥:</strong> ${err.message}
                </div>
            `;
        });
}
</script>
{% endblock %}
